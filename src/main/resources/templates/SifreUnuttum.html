<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale-2,  shrink-to-fit=no"/>
    <meta name="description" content=""/>
    <meta name="author" content=""/>
    <title>U-ETDS - Şifremi Unuttum</title>

    <link rel="stylesheet" th:href="@{/css/pace.min.css}"/>
    <script th:src="@{/js/pace.min.js}"></script>
    <!--favicon-->
    <link rel="icon" th:href="@{/images/favicon.ico}" type="image/x-icon">
    <!-- simplebar CSS-->
    <link th:href="@{/plugins/simplebar/css/simplebar.css}" rel="stylesheet"/>
    <!-- Bootstrap core CSS-->
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet"/>
    <!-- animate CSS-->
    <link th:href="@{/css/animate.css}" rel="stylesheet" type="text/css"/>
    <!-- Icons CSS-->
    <link th:href="@{/css/icons.css}" rel="stylesheet" type="text/css"/>
    <!-- Sidebar CSS-->
    <link th:href="@{/css/sidebar-menu.css}" rel="stylesheet"/>
    <!-- Custom Style-->
    <link th:href="@{/css/app-style.css}" rel="stylesheet"/>
    <!-- skins CSS-->
    <link th:href="@{/css/skins.css}" rel="stylesheet"/>
    <!--Bootstrap Datepicker-->
    <link th:href="@{/plugins/bootstrap-datepicker/css/bootstrap-datepicker.min.css}" rel="stylesheet" type="text/css">

    <link rel="stylesheet" th:href="@{/plugins/notifications/css/lobibox.min.css}"/>
    <!-- Dropzone css -->
    <link th:href="@{/plugins/dropzone/css/dropzone.css}" rel="stylesheet" type="text/css">

    <style>
        .pass_show {
            position: relative
        }

        .pass_show .ptxt {

            position: absolute;

            top: 50%;

            right: 10px;

            z-index: 1;

            color: #7934f3;

            margin-top: -10px;

            cursor: pointer;

            transition: .3s ease all;
        }

        .pass_show .ptxt:hover {
            color: #333333;
        }
    </style>
</head>
<body>
<!-- Start wrapper-->
<div id="wrapper">
    <div id="loading-screen" style="display: none; background-color: white">
        <div class='loader'>
            <div class='loader--dot'></div>
            <div class='loader--dot'></div>
            <div class='loader--dot'></div>
            <div class='loader--dot'></div>
            <div class='loader--dot'></div>
            <div class='loader--dot'></div>
            <div class='loader--text'></div>
        </div>
    </div>
    <div class="height-100v d-flex align-items-center justify-content-center">
        <div class="card-authentication2">
            <div class="card-group">
                <div class="card mb-0">
                    <div class="bg-reset-password2"></div>
                    <center>
                        <div class="form-group center">
                            <center>
                                <div class="center" id="timer"
                                     style="font-size: xx-large; color:  #7934f3; padding-bottom: 20px"></div>
                            </center>
                        </div>
                    </center>
                    <div class="card-img-overlay rounded-left my-5">
                    </div>
                </div>
                <div class="card mb-0 ">
                    <div class="card-body">
                        <div class="card-content p-3">
                            <div class="text-center js-tilt" data-tilt>
                                <img th:src="@{/images/logo-icon.png}" alt="IMG">
                            </div>
                            <br>
                            <div class="card-title text-uppercase text-center pb-3">Şİfremİ Unuttum</div>
                            <p id="baslık" class="text-center pb-2">Lütfen şifrenizi size ulaştırmamızı istediğiniz
                                yöntemi
                                seçiniz.</p>
                            <div class="form-group">
                                <form id="ForgetPass">
                                    <div id="firstScreen">
                                        <div class="position-relative has-icon-left">
                                            <label for="inline-radio-primary" class="sr-only">Email Address</label>

                                            <div id="radio" class="icheck-material-primary icheck-inline">
                                                <input type="radio" id="inline-radio-primary" onclick="baslikdegis()"
                                                       name="inlineradio" required value="email"/>
                                                <label for="inline-radio-primary">E-maİl</label>
                                                <br>
                                                <div class="icheck-material-info icheck-inline">
                                                    <input type="radio" id="inline-radio-info" onclick="baslikdegis()"
                                                           name="inlineradio" required value="telefon"/>
                                                    <label for="inline-radio-info">Cep Telefonu</label>
                                                    <br> <br>
                                                </div>
                                            </div>
                                        </div>
                                        <p id="baslık2" style="font-size: small" class="text-center pb-2"></p>
                                        <input type="email" class="form-control" id="txtMail" name="txtMail"
                                               placeholder="E-Mail Adresinizi Giriniz" required>

                                        <button onclick="gonderFonk()" id="btn-gonder" type="button" form="ForgetPass"
                                                class="btn btn-primary btn-block mt-3" formnovalidate>
                                            Gönder
                                        </button>
                                        <div class="clearfix"></div>
                                        <div class="text-center pt-3">
                                        </div>
                                    </div>
                                </form>
                                <div class="form-group ">
                                    <div id="area"></div>
                                </div>
                                <div class="p-3">
                                    <hr>
                                    <p class="text-dark mb-0 text-center"><a href="/login"> Giriş
                                        Sayfasına Geri Dön</a></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card mb-0 ">
                <div class="card-body">
                    <p class="text-center">U-ETDS, Ulaştırma Bakanlığı Onaylı "Ulaştırma Elektronik
                        Takip ve Denetim Sistemi" Uygulaması Yazılımıdır. Kullanıcı dostu, kolaylaştırılmış
                        arayüzlü uygulamamız ve nitelikli devam desteği ile hizmet etmekteyiz.</p>
                </div>
            </div>
        </div>
    </div>

    <!--Start Back To Top Button-->
    <a href="javaScript:void(0);" class="back-to-top"><i class="fa fa-angle-double-up"></i> </a>
    <!--End Back To Top Button-->


</div><!--wrapper-->

<!-- Bootstrap core JavaScript-->
<script th:src="@{/js/jquery.min.js}"></script>
<script th:src="@{/js/popper.min.js}"></script>
<script th:src="@{/js/bootstrap.min.js}"></script>

<!-- simplebar js -->
<script th:src="@{/plugins/simplebar/js/simplebar.js}"></script>
<!-- sidebar-menu js -->
<script th:src="@{/js/sidebar-menu.js}"></script>
<script th:src="@{/js/jquery-serialize.min.js}"></script>
<!-- Custom scripts -->
<script th:src="@{/js/app-script.js}"></script>
<script th:src="@{/js/bildirim.js}"></script>
<script th:src="@{/plugins/notifications/js/lobibox.min.js}"></script>
<script th:src="@{/plugins/notifications/js/notifications.min.js}"></script>
<script th:src="@{/plugins/notifications/js/notification-custom-script.js}"></script>

<!--&lt;!&ndash;Form Validatin Script&ndash;&gt;-->
<!--<script th:src="@{/plugins/jquery-validation/js/jquery.validate.min.js}"></script>-->

<script>
    function baslikdegis() {
        if ($('#inline-radio-primary').is(':checked')) {
            document.getElementById("baslık2").innerHTML = "Onay Kodu Mail Adresinize Gönderilecektir.";
        }
        if ($('#inline-radio-info').is(':checked')) {
            document.getElementById("baslık2").innerHTML = "Onay Kodu Mail Adresinize Kayıtlı <br> Telefon Numaranıza Gönderilecektir.";
        }
    }
</script>
<script>
    var xxxx;
    var mail;
    mail = $("#txtMail").val();
    var xxx;
    $("#inline-radio-primary").change(function () {
        xxx = 2;
        console.log(xxx)
    });
    $("#inline-radio-info").change(function () {
        xxx = 1;
        console.log(xxx)
    });

    function gonderFonk() {
        if ($("#txtMail").val() === "") {
            error_noti_yuk('Mail Adresi Giriniz.');
        } else {
            document.getElementById("btn-gonder").disabled = true;
            $('#loading-screen').fadeIn();
            var formData = {
                "yontem": xxx,
                "email": $("#txtMail").val(),
            };
            console.log(formData)
            $.ajax({
                type: "POST",
                async: false,
                contentType: "application/json",
                url: "/Sifre/passReset",
                data: JSON.stringify(formData),
                dataType: 'json',
                cache: false,
                timeout: 600000,
                // request().function(response.data()).
                success: function (response) {
                    $('#loading-screen').fadeOut('slow');
                    // success_noti_drop(titleyuk = "Dikkat!", msgyuk = response.message);
                    console.log(response);
                    xxxx = response;
                    $("#btn-gonder").prop("disabled", false);
                },
                error: function (e) {
                    console.log("ERROR : ", e);
                    $("#btn-gonder").prop("disabled", false);
                },
            });

            document.getElementById("firstScreen").hidden = true;
            document.getElementById("baslık").hidden = true;
            document.getElementById("baslık2").hidden = true;
            console.log(xxxx);
            if (xxxx.result) {
                if (xxx === 2) {
                    inf_msg(msg = "Mail Adresinizi Kontrol Ediniz");
                    document.getElementById("timer").innerHTML = " <span id=\"timer\">02:00</span>"
                    document.getElementById("area").innerHTML = "<form id=\"onaykodform\">\n" +
                        "                                            <div class=\"col-md-12\">\n" +
                        "                                                <label for=\"name\" class=\"sr-only\">Onay Kodu Giriniz</label>\n" +
                        "                                                <input required type=\"text\" class=\"form-control\" id=\"onaykod\" name=\"onaykod\"\n" +
                        "                                                       placeholder=\"Onay Kodunu Giriniz\" maxlength=\"6\" onkeypress=\"return (event.charCode !=8 && event.charCode ==0 || ( event.charCode == 46 || (event.charCode >= 48 && event.charCode <= 57)))\" required>\n" +
                        "                                                <div class=\"form-control-position\">\n" +
                        "                                                <i class=\"zmdi zmdi-phone\"></i>\n" +
                        "                                                    </div>\n" +
                        "                                                    <label>Yeni Şifrenizi Giriniz</label>\n" +
                        "                                                <div class=\"form-group pass_show\">\n" +
                        "                                                    <input required onfocus=\"this.value=''\" type=\"password\" maxlength=\"25\" id=\'newpass\' class=\"form-control\" placeholder=\"Yeni Şifre\">\n" +
                        "                                                    </div>\n" +
                        "                                                    <label>Yeni Şifrenizi Tekrar Giriniz</label>\n" +
                        "                                                <div class=\"form-group pass_show\">\n" +
                        "                                                    <input required onfocus=\"this.value=''\" type=\"password\" maxlength=\"25\" id=\'newpass2\' class=\"form-control\" placeholder=\"Yeni Şifre\">\n" +
                        "                                                    </div>\n" +
                        "                                                <button type=\"button\"  onclick=\"onaykod()\" id='onayGonder'  form=\"ForgetPass\"  class=\"btn btn-primary btn-block mt-3\">\n" +
                        "                                                    Gönder" +
                        "                                                </button>" +
                        "                                            </div>" +
                        "                                        </form> ";
                } else if (xxx === 1) {
                    inf_msg(msg = "Telefonunuzu Kontrol Ediniz");
                    document.getElementById("timer").innerHTML = " <span id=\"timer\">02:00</span>"
                    document.getElementById("area").innerHTML = "<form id=\"onaykodform\">\n" +
                        "                                            <div class=\"col-md-12\">\n" +
                        "                                                <label for=\"name\" class=\"sr-only\">Onay Kodu Giriniz</label>\n" +
                        "                                                <input required type=\"text\" class=\"form-control\" id=\"onaykod\" name=\"onaykod\"\n" +
                        "                                                       placeholder=\"Onay Kodunu Giriniz\" maxlength=\"6\" onkeypress=\"return (event.charCode !=8 && event.charCode ==0 || ( event.charCode == 46 || (event.charCode >= 48 && event.charCode <= 57)))\" required>\n" +
                        "                                                <div class=\"form-control-position\">\n" +
                        "                                                <i class=\"zmdi zmdi-phone\"></i>\n" +
                        "                                                    </div>\n" +
                        "                                                    <label>Yeni Şifrenizi Giriniz</label>\n" +
                        "                                                <div class=\"form-group pass_show\">\n" +
                        "                                                    <input required onfocus=\"this.value=''\" type=\"password\" maxlength=\"25\" id=\'newpass\' class=\"form-control\" placeholder=\"Yeni Şifre\">\n" +
                        "                                                    </div>\n" +
                        "                                                    <label>Yeni Şifrenizi Tekrar Giriniz</label>\n" +
                        "                                                <div class=\"form-group pass_show\">\n" +
                        "                                                    <input required onfocus=\"this.value=''\" type=\"password\" maxlength=\"25\" id=\'newpass2\' class=\"form-control\" placeholder=\"Yeni Şifre\">\n" +
                        "                                                    </div>\n" +
                        "                                                <button type=\"button\"  onclick=\"onaykod()\" id='onayGonder'  form=\"ForgetPass\"  class=\"btn btn-primary btn-block mt-3\">\n" +
                        "                                                    Gönder" +
                        "                                                </button>" +
                        "                                            </div>" +
                        "                                        </form> ";
                } else {
                    document.getElementById("area").innerHTML = "<div style='height: 255px'>\n" +
                        "                                                    <label style='font-size: large; color: #7934f3; padding-top: 30px'>Teknik bir hata oluştu. <br> Lütfen Tekrar deneyiniz.</label>\n" +
                        "                                            </div>"
                }
                let timerOn = true;

                function timer(remaining) {
                    var m = Math.floor(remaining / 60);
                    var s = remaining % 60;

                    m = m < 10 ? '0' + m : m;
                    s = s < 10 ? '0' + s : s;
                    document.getElementById('timer').innerHTML = m + ':' + s;
                    remaining -= 1;

                    if (remaining >= 0 && timerOn) {
                        setTimeout(function () {
                            timer(remaining);
                        }, 1000);
                        return;
                    }

                    if (!timerOn) {
                        // Do validate stuff here
                        document.getElementById("onaykod").readonly = true;
                        document.getElementById("onaykod").readonly = readonly;
                        console.log("Girdi Kapatıldı");
                        return;
                    }

                    // Do timeout stuff here
                    error_noti_yuk('Onay kodu için süre aşımı');
                }

                timer(120);
            } else {
                document.getElementById("area").innerHTML = "<div class='text-center' style='height: 255px'>\n" +
                    "                                                    <label class='text-center' style='font-size: large; color: #7934f3; padding-top: 30px'>" + xxxx.message + "<br>Lütfen Tekrar deneyiniz.</label>\n" +
                    "                                            </div>"
            }
        }
    }

    function onaykod() {
        if ($("#newpass").val() !== "" && $("#newpass2").val() !== "" && $("#onaykod").val() !== "") {
            if ($("#newpass").val() === $("#newpass2").val()) {
                document.getElementById("onayGonder").disabled = true;
                $('#loading-screen').fadeIn();
                var formData = {
                    "email": $("#txtMail").val(),
                    "newPassword": $("#newpass2").val(),
                    "confirmationCode": $("#onaykod").val(),
                };
                console.log(formData)
                $.ajax({
                    type: "POST",
                    contentType: "application/json",
                    url: "/Sifre/passwordChange",
                    data: JSON.stringify(formData),
                    dataType: 'json',
                    cache: false,
                    timeout: 600000,
                    success: function (response) {
                        $('#loading-screen').fadeOut('slow');
                        if (response) {
                            console.log("success")
                            success_noti()
                        } else {
                            document.getElementById("onayGonder").disabled = false;
                            error_noti()
                        }

                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                    }
                });
                success_noti_drop(titleyuk = "Dikkat!", msgyuk = "Şifre Sıfırlama Başarılı.");
                setTimeout(function () {
                    window.location.replace("/login");
                }, 2000);
            } else {
                error_noti_yuk("Şifreler Uyuşmuyor. Lütfen Kontrol Ediniz.");
            }
        } else {
            date_msg("Dikkat!", "Lütfen Boş Alanları Doldurunuz.")
        }
    }
</script>
<script>
    $(document).ready(function () {
        $("#onaykod").keyup(function (e) {
            var regex = /^[0-9]*$/;
            if (regex.test(this.value) !== true) {
                date_msg("Dikkat!", "Onay Alanına Numerik Karakter Giriniz")
                this.value = this.value.replace(/[^0-9]+/, '')
            }
            ;
        });
    });
</script>
<script>
    $(document).ready(function () {
        $('.pass_show').append('<span class="ptxt">Göster</span>');
    });

    $(document).on('click', '.pass_show .ptxt', function () {

        $(this).text($(this).text() == "Göster" ? "Gizle" : "Göster");

        $(this).prev().attr('type', function (index, attr) {
            return attr == 'password' ? 'text' : 'password';
        });
    });

</script>
<script th:src="@{/js/tilt.jquery.min.js}"></script>
<script>
    $('.js-tilt').tilt({
        scale: 1.1
    })
</script>


</body>
</html>




